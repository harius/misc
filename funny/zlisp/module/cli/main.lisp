(def readme "A basic REPL for zlisp.")

(require (concat-bytestrings this-directory "/../zlisp/main.lisp"))

(defn repl
  (nsp)
  (def tmp (fprintf stdout "> "))
  (switch (read stdin)
	  ((:eof)
	   (fprintf stdout "\n"))
	  ((:ok datum)
	   (switch (eval datum nsp)
		   ((:ok val)
		    (ignore (fprintf-bytestring stdout "%s\n" (repr val)))
		    (repl nsp))
		   ((:err msg)
		    (ignore (fprintf-bytestring stderr "eval error: %s\n" msg))
		    (repl nsp))
		   ((:context ctxt)
		    (repl ctxt))))
	  ((:err msg)
	   (ignore (fprintf-bytestring stderr "read error: %s\n" msg))
	   (repl nsp))))

(def-or-panic prelude_ (prelude))
(ignore (repl prelude_))
