(defn repl
  (nsp)
  (def tmp (fprintf stdout "> "))
  (switch (read stdin)
	  ((:eof)
	   (fprintf stdout "\n"))
	  ((:ok datum)
	   (switch (eval-in nsp datum)
		   ((:ok val)
		    (ignore (print val)))
		   ((:err msg)
		    (ignore (fprintf-bytestring stderr "eval error: %s\n" msg))))
	   (repl nsp))
	  ((:err msg)
	   (ignore (fprintf-bytestring stderr "read error: %s\n" msg))
	   (repl nsp))))

(def ns (make-namespace))
(repl ns)
